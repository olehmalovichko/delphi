Департамент пластиковых карт
Отдел системного обеспечения


     Инструкция по установке программы-сервера авторизации через TCP/IP
                                 Версии i.1.XX
     ──────────────────────────────────────────────────────────────────


                                 1. Введение.

   Программа предназначена для  отправки авторизационного запроса  через каналы
 TCP/IP и получения  ответа о допустимости  проведения операции по  пластиковой
 карте.

                                2. Требования.

   Программа работает под управлением Windows 95/98/NT с установленной
 поддержкой TCP/IP.  Состоит из следующих основных частей:

   POSAGENT.NT   - Основной исполняемый модуль (WinNT chracter-mode console);
   POSAGENT.W95  - Основной исполняемый модуль (Win95 chracter-mode console);
   POSAGENT.INI  - Файл конфигурации;
   POSAGENT.KEY  - Ключ к программе;
   POSAGENT.TXT  - Данное руководство;

   Для работы с программой  требуется установленный комплекс по  Эквайрингу EF.
 Взаимодействие программ осуществляется путем обмена файлами, поэтому  возможны
 варинаты установки POSAGENT  и EF как  на одном компьютере,  так и на  разных.
 Предпочтительным является вариант установки POSAGENT в отделе автоматизации.


                           3. Установка программы.

   Создайте  каталог  на  локальном  диске  коммуникационной машины. Разверните
 туда  содержимое  полученного  архива.  Исполняемый  модуль  POSAGENT.W95  или
 POSAGENT.NT переименуйте  в POSAGENT.EXE,  в зависимости  от типа операционной
 системы,  под  которой  он  будет  работать  (Windows  95 или Windows NT). Для
 нормальной работы  программы   требуется настроить  файл конфигурации.  Пример
 файла конфигурации:

 -----------------------------[ POSAGENT.INI ]---------------------------------
 [Settings]
 HostCount=1
 ScanPath=g:\everyone\exchange
 ScanTime=1
 WaitConf=20
 TPDUId=96
 NII=2
 IIT=0

 [Host1]
 Address=10.1.11.157
 Port=5020
 -----------------------------[ POSAGENT.INI ]---------------------------------

 Секция [Settings]:

 ■ HostCount Количество секций с описанием хостов [HostX] в файле конфигурации.
             ВНИМАНИЕ! Поскольку на данный момент существует только один  хост,
             данный параметр зарезервирован  для  последующего  использования и
             пока должен быть установлен в 1.

 ■ ScanPath  Программа  получает   все   запросы  в  виде  файлов,  в   которых
             содержится вся необходимая информация для проведения  авторизации.
             Опция  должна  указывать  на  каталог, в котором будет происходить
             обмен между сервером (данной программой) и клиентом (программа  по
             Эквайрингу EF или POS Эмулятор).
             ВНИМАНИЮ СЕТЕВЫХ АДМИНИСТРАТОРОВ! ПОСКОЛЬКУ В БОЛЬШИНСТВЕ  СЛУЧАЕВ
             ТРЕБУЕТСЯ  СЕТЕВОЙ  КАТАЛОГ,  НЕОБХОДИМО  ОБЕСПЕЧИТЬ ТРЕБОВАНИЯ ПО
             БЕЗОПАСНОСТИ.  КАТАЛОГ  С  ПРАВАМИ  НА  ЗАПИСЬ,  ЧТЕНИЕ, УДАЛЕНИЕ,
             ПОИСК ДОЛЖЕН БЫТЬ ОТКРЫТ ТОЛЬКО ДЛЯ СЕРВЕРА И КЛИЕНТОВ!!!

 ■ ScanTime  Время сканирования  в секундах. Не лимитировано, но  рекомендуется
             1-15 сек. По умолчанию установлено в 1 сек.

 ■ WaitConf  Время  ожидания  подтверждения  от  клиента.  В  случае  успешного
             соединения и получения ответа программа-сервер в указанный каталог
             (см.выше ScanPath) записывает  файлы/флаги ответа. Клиент  ожидает
             ответ и в случае их получения удаляет флаг. Эта операция  является
             подтверждением получения ответа  со стороны Клиента.  По умолчанию
             установлено в 20 сек.

 ■ TPDUId    Системный параметр. Должен быть  установлен жестко в 96.  В случае
             необходимости его изменения, филиал/отделение будет  дополнительно
             информирован.

 ■ NII       Системный параметр. Должен быть  установлен жестко в 2 .  В случае
             необходимости его изменения, филиал/отделение будет  дополнительно
             информирован.

 ■ IIT       Системный параметр. Должен быть  установлен жестко в 0 .  В случае
             необходимости его изменения, филиал/отделение будет  дополнительно
             информирован.

 Секция [HostX]:

 ■ Address   Интранетовский  адрес хоста  в октетной форме  XXX.XXX.XXX.XXX. На
             данный момент это адрес 10.1.11.157

 ■ Port      Номер  порта соедиения для установленного хоста. На  данный момент
             должен быть 5020.


                     4. Приложение (описание сообщений).

 The Windows Sockets DLL is acceptable. Proceed.
 Установлена поддержка Windows Socket DLL версии 1.1.

 Winsock API is not supported or incorrect winsock version
 Не установлена поддержка TCP/IP или некорректная версия Windows Socket DLL

 Can't open ready flag
 Невозможно создать флаг READY. Неправильно определен путь сканирования.

 Successful install thread to wait for a escape
 Успешно установлена  нить обработки  ожидания нажатия  ESC (Прерывание  работы
 программы). Рекомендуется   в дальнейшем   выходить из   прораммы только  этим
 путем.

 It is impossible to establish a thread to check for terminating keystroke
 Невозможно установить нить, чтобы проверить нажатие клавиши завершения

 Waiting for receive...
 Ожидание запроса на авторизацию.

 Successful install thread
 Успешно установлена нить обработки

 It is impossible to establish a thread
 Невозможно установить нить обработки.

 It is impossible to start a new session
 Невозможно запустить новую сессию. Закончился лимит активных нитей (5)

 Couldn't delete flag
 Невозможно удалить флаг запроса

 Can't find key file
 Не обнаружен файл с ключем.

 Can't open key file
 Невозможно открыть файл с ключем.

 Can't read key file
 Невозможно прочитать файл с ключем.

 Key expired. Program aborted.
 Закончилась лицензия ключа.

 Key corrupted. Program aborted.
 Ключ разрушен.

 Accepted connection
 Установлено соединение с хостом.

 Req:XX
 Тип сообщения.

 Term:XXXXXXXX
 Номер терминала (мерчанта).

 Card:XXXXXXXXXXXXXXXX
 Номер карты.

 Amount:XXXXXXX
 Сумма запроса в копейках/центах.

 Rsp:XX
 Код ответа.

 Reversal Rsp:XX
 Код ответа при отмене операции.

 Auth:XXXXXX
 Код авторизации.

 Msgr:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
 Сообщение ответа.

 The session is completed successfully
 Успешное завершение сессии.

 The session is completed with an error
 Сессия завершена с ошибкой

 Couldn't close thread handle
 Невозможно закрыть индекс нити.

 Couldn't close search handle
 Невозможно закрыть индекс поиска.

 Any section "Host" in a Ini file is not found
 Не обнаружена секция [HostX] в INI файле.

 Wrong format of address for section
 Неправильно задан адрес хоста для секции [HostX]

 There is not enough port in section
 Не задан порт в секции [HostX]

 Reversal on previous message is successfully sent
 Отмена операции успешно послана.

 Posagent: Ошибка #11#
 Posagent: Ошибка #12#
 Posagent: Ошибка #13#
 Posagent: Ошибка #14#
 Posagent: Ошибка #15#
 Posagent: Ошибка #16#
 Posagent: Ошибка #17#
 Posagent: Ошибка #18#
 Posagent: Ошибка #19#
 Неправильно задано поле в пакете запроса

 Posagent: Ошибка #20#
 Posagent: Ошибка #25#
 Невозможно открыть соединение (коммуникационные ошибки)

 Posagent: Ошибка #21#
 Posagent: Ошибка #26#
 Невозможно отправить запрос (коммуникационные ошибки)

 Posagent: Ошибка #22#
 Posagent: Ошибка #27#
 Невозможно принять ответ (коммуникационные ошибки)

 Posagent: Ошибка #23#
 Невозможно закрыть соединение (коммуникационные ошибки)

 Posagent: Ошибка #50#
 Posagent: Ошибка #55#
 Длина данных в заголовке не соответствует длине принятых данных

 Posagent: Ошибка #51#
 Posagent: Ошибка #56#
 Неправильный TPDUId в приянтых данных

 Posagent: Ошибка #52#
 Posagent: Ошибка #57#
 Неправильный NII

 Posagent: Ошибка #53#
 Posagent: Ошибка #58#
 Неправильный IIT

 Posagent: Ошибка #54#
 Posagent: Ошибка #59#
 Неправильный тип сообщения в принятых данных
 ===============================================================================
  (0562) 390152 Андрей Пономарев                                   23.11.98
